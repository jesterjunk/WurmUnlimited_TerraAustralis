<!DOCTYPE html>
<html lang="en" style="background: hsl(70, 8%, 15%); overflow-y: scroll;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wurm Unlimited: Terra Australis — Terra Communis Public Farm</title>
    <style>
        body {
            margin: 0;
            font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif;
            color: beige;
            text-align: center;
        }
        .grid {
            margin: 0 auto;
            display: grid;
            position: relative;
        }
        .tile {
            display: flex;
            align-items: center;
            justify-content: center;
            background-repeat: repeat;
            position: absolute;
        }
    </style>
</head>
<body>

<h3>Wurm Unlimited: Terra Australis — Terra Communis Public Farm</h3>

<div class="grid" id="grid"></div>

<script>

const tile_size = 24;
// const texture_size = tile_size * 2 ** 2;
const texture_size = 24;

const grid = `
00000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000
00000111111111111111111111111111111111111111111111111111111100000
000001999991DDDDDDDDD1xxxxxxxxx1iiiiiiiii111hhhhhhhhh155555100000
000001999991DDDDDDDDD1xxxxxxxxx1iiiiiiiii111hhhhhhhhh155555100000
000001999991DDDDDDDDD1xxxxxxxxx1iiiiiiiii111hhhhhhhhh155555100000
000001999991DDDDDDDDD1xxxxxxxxx1iiiiiiiii111hhhhhhhhh155555100000
000001999991DDDDDDDDD1xxxxxxxxx1iiiiiiiii111hhhhhhhhh155555100000
000001999991DDDDDDDDD1xxxxxxxxx1iiiiiiiii111hhhhhhhhh155555100000
000001999991DDDDDDDDD1xxxxxxxxx1iiiiiiiii111hhhhhhhhh155555100000
000001999991DDDDDDDDD1xxxxxxxxx1iiiiiiiii111hhhhhhhhh155555100000
000001999991DDDDDDDDD1xxxxxxxxx1iiiiiiiii111hhhhhhhhh155555100000
00000199999111111111111111111111111111111111111111111155555100000
000001999991EEEEEEEEE1wwwwwwwww1jjjjjjjjj111ggggggggg155555100000
000001999991EEEEEEEEE1wwwwwwwww1jjjjjjjjj111ggggggggg155555100000
000001999991EEEEEEEEE1wwwwwwwww1jjjjjjjjj111ggggggggg155555100000
000001999991EEEEEEEEE1wwwwwwwww1jjjjjjjjj111ggggggggg155555100000
000001999991EEEEEEEEE1wwwwwwwww1jjjjjjjjj111ggggggggg155555100000
000001999991EEEEEEEEE1wwwwwwwww1jjjjjjjjj111ggggggggg155555100000
000001999991EEEEEEEEE1wwwwwwwww1jjjjjjjjj111ggggggggg155555100000
000001999991EEEEEEEEE1wwwwwwwww1jjjjjjjjj111ggggggggg155555100000
000001999991EEEEEEEEE1wwwwwwwww1jjjjjjjjj111ggggggggg155555100000
00000111111111111111111111111111111111111111111111111111111100000
000001888881FFFFFFFFF1vvvvvvvvv1kkkkkkkkk111fffffffff144444100000
000001888881FFFFFFFFF1vvvvvvvvv1kkkkkkkkk111fffffffff144444100000
000001888881FFFFFFFFF1vvvvvvvvv1kkkkkkkkk111fffffffff144444100000
000001888881FFFFFFFFF1vvvvvvvvv1kkkkkkkkk111fffffffff144444100000
000001888881FFFFFFFFF1vvvvvvvvv1kkkkkkkkk111fffffffff144444100000
000001888881FFFFFFFFF1vvvvvvvvv1kkkkkkkkk111fffffffff144444100000
000001888881FFFFFFFFF1vvvvvvvvv1kkkkkkkkk111fffffffff144444100000
000001888881FFFFFFFFF1vvvvvvvvv1kkkkkkkkk111fffffffff144444100000
000001888881FFFFFFFFF1vvvvvvvvv1kkkkkkkkk111fffffffff144444100000
00000188888111111111111111111111111111111111111111111144444100000
000001888881GGGGGGGGG1uuuuuuuuu1lllllllll111eeeeeeeee144444100000
000001888881GGGGGGGGG1uuuuuuuuu1lllllllll111eeeeeeeee144444100000
000001888881GGGGGGGGG1uuuuuuuuu1lllllllll111eeeeeeeee144444100000
000001888881GGGGGGGGG1uuuuuuuuu1lllllllll111eeeeeeeee144444100000
000001888881GGGGGGGGG1uuuuuuuuu1lllllllll111eeeeeeeee144444100000
000001888881GGGGGGGGG1uuuuuuuuu1lllllllll111eeeeeeeee144444100000
000001888881GGGGGGGGG1uuuuuuuuu1lllllllll111eeeeeeeee144444100000
000001888881GGGGGGGGG1uuuuuuuuu1lllllllll111eeeeeeeee144444100000
000001888881GGGGGGGGG1uuuuuuuuu1lllllllll111eeeeeeeee144444100000
00000111111111111111111111111111111111111111111111111111111100000
000001111111111111111111111111111111111111A1111111111111111100000
00000111111111111111111111111111111111111111111111111111111100000
000001777771HHHHHHHHH1ttttttttt1mmmmmmmmm111ddddddddd133333100000
000001777771HHHHHHHHH1ttttttttt1mmmmmmmmm111ddddddddd133333100000
000001777771HHHHHHHHH1ttttttttt1mmmmmmmmm111ddddddddd133333100000
000001777771HHHHHHHHH1ttttttttt1mmmmmmmmm1B1ddddddddd133333100000
000001777771HHHHHHHHH1ttttttttt1mmmmmmmmm111ddddddddd133333100000
000001777771HHHHHHHHH1ttttttttt1mmmmmmmmm1C1ddddddddd133333100000
000001777771HHHHHHHHH1ttttttttt1mmmmmmmmm111ddddddddd133333100000
000001777771HHHHHHHHH1ttttttttt1mmmmmmmmm111ddddddddd133333100000
000001777771HHHHHHHHH1ttttttttt1mmmmmmmmm111ddddddddd133333100000
00000177777111111111111111111111111111111111111111111133333100000
000001777771IIIIIIIII1sssssssss1nnnnnnnnn111ccccccccc133333100000
000001777771IIIIIIIII1sssssssss1nnnnnnnnn111ccccccccc133333100000
000001777771IIIIIIIII1sssssssss1nnnnnnnnn111ccccccccc133333100000
000001777771IIIIIIIII1sssssssss1nnnnnnnnn111ccccccccc133333100000
000001777771IIIIIIIII1sssssssss1nnnnnnnnn111ccccccccc133333100000
000001777771IIIIIIIII1sssssssss1nnnnnnnnn111ccccccccc133333100000
000001777771IIIIIIIII1sssssssss1nnnnnnnnn111ccccccccc133333100000
000001777771IIIIIIIII1sssssssss1nnnnnnnnn111ccccccccc133333100000
000001777771IIIIIIIII1sssssssss1nnnnnnnnn111ccccccccc133333100000
00000111111111111111111111111111111111111111111111111111111100000
000001666661JJJJJJJJJ1rrrrrrrrr1ooooooooo111bbbbbbbbb122222100000
000001666661JJJJJJJJJ1rrrrrrrrr1ooooooooo111bbbbbbbbb122222100000
000001666661JJJJJJJJJ1rrrrrrrrr1ooooooooo111bbbbbbbbb122222100000
000001666661JJJJJJJJJ1rrrrrrrrr1ooooooooo111bbbbbbbbb122222100000
000001666661JJJJJJJJJ1rrrrrrrrr1ooooooooo111bbbbbbbbb122222100000
000001666661JJJJJJJJJ1rrrrrrrrr1ooooooooo111bbbbbbbbb122222100000
000001666661JJJJJJJJJ1rrrrrrrrr1ooooooooo111bbbbbbbbb122222100000
000001666661JJJJJJJJJ1rrrrrrrrr1ooooooooo111bbbbbbbbb122222100000
000001666661JJJJJJJJJ1rrrrrrrrr1ooooooooo111bbbbbbbbb122222100000
00000166666111111111111111111111111111111111111111111122222100000
000001666661KKKKKKKKK1qqqqqqqqq1ppppppppp111aaaaaaaaa122222100000
000001666661KKKKKKKKK1qqqqqqqqq1ppppppppp111aaaaaaaaa122222100000
000001666661KKKKKKKKK1qqqqqqqqq1ppppppppp111aaaaaaaaa122222100000
000001666661KKKKKKKKK1qqqqqqqqq1ppppppppp111aaaaaaaaa122222100000
000001666661KKKKKKKKK1qqqqqqqqq1ppppppppp111aaaaaaaaa122222100000
000001666661KKKKKKKKK1qqqqqqqqq1ppppppppp111aaaaaaaaa122222100000
000001666661KKKKKKKKK1qqqqqqqqq1ppppppppp111aaaaaaaaa122222100000
000001666661KKKKKKKKK1qqqqqqqqq1ppppppppp111aaaaaaaaa122222100000
000001666661KKKKKKKKK1qqqqqqqqq1ppppppppp111aaaaaaaaa122222100000
00000111111111111111111111111111111111111111111111111111111100000
00000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000
`;

const grid_tile_types = {
    "0": {"type": "terrain",   "label": "Grass",               "label_visible": 0,    "skill": 0,     "tile": "grass",      "grid": "",       "count": "1480",    "planted": 1 },
    "1": {"type": "paving",    "label": "Pottery",             "label_visible": 0,    "skill": 0,     "tile": "pottery",    "grid": "",       "count": "1210",    "planted": 1 },
    "2": {"type": "tree",      "label": "Apple",               "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "5x9",    "count": "95",      "planted": 0 },
    "3": {"type": "tree",      "label": "Cherry",              "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "5x9",    "count": "95",      "planted": 0 },
    "4": {"type": "tree",      "label": "Lemon",               "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "5x9",    "count": "95",      "planted": 0 },
    "5": {"type": "tree",      "label": "Olive",               "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "5x9",    "count": "95",      "planted": 0 },
    "6": {"type": "tree",      "label": "Acorn",               "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "5x9",    "count": "95",      "planted": 0 },
    "7": {"type": "tree",      "label": "Chestnut",            "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "5x9",    "count": "95",      "planted": 0 },
    "8": {"type": "tree",      "label": "Pinenut",             "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "5x9",    "count": "95",      "planted": 0 },
    "9": {"type": "tree",      "label": "Walnut",              "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "5x9",    "count": "95",      "planted": 0 },
    "a": {"type": "crop",      "label": "Potato",              "label_visible": 1,    "skill": 4,     "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "b": {"type": "crop",      "label": "Cotton",              "label_visible": 1,    "skill": 7,     "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "c": {"type": "crop",      "label": "Rye",                 "label_visible": 1,    "skill": 10,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "d": {"type": "crop",      "label": "Wemp",                "label_visible": 1,    "skill": 10,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "e": {"type": "crop",      "label": "Cucumber",            "label_visible": 1,    "skill": 15,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "f": {"type": "crop",      "label": "Oat",                 "label_visible": 1,    "skill": 15,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "g": {"type": "crop",      "label": "Pumpkin",             "label_visible": 1,    "skill": 15,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "h": {"type": "crop",      "label": "Barley",              "label_visible": 1,    "skill": 20,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "i": {"type": "crop",      "label": "Carrot",              "label_visible": 1,    "skill": 25,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "j": {"type": "crop",      "label": "Wheat",               "label_visible": 1,    "skill": 30,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "k": {"type": "crop",      "label": "Cabbage",             "label_visible": 1,    "skill": 35,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "l": {"type": "crop",      "label": "Corn",                "label_visible": 1,    "skill": 40,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "m": {"type": "crop",      "label": "Tomato",              "label_visible": 1,    "skill": 45,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "n": {"type": "crop",      "label": "Lettuce",             "label_visible": 1,    "skill": 55,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "o": {"type": "crop",      "label": "Onion",               "label_visible": 1,    "skill": 60,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "p": {"type": "crop",      "label": "Strawberries",        "label_visible": 1,    "skill": 60,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "q": {"type": "crop",      "label": "Pea pod",             "label_visible": 1,    "skill": 65,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "r": {"type": "crop",      "label": "Garlic",              "label_visible": 1,    "skill": 70,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "s": {"type": "crop",      "label": "Garlic",              "label_visible": 1,    "skill": 70,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "t": {"type": "crop",      "label": "Sugar\nbeet",         "label_visible": 1,    "skill": 85,    "tile": "farm",       "grid": "9x9",    "count": "81",      "planted": 1 },
    "u": {"type": "bush",      "label": "Blue\nGrape",         "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "v": {"type": "bush",      "label": "Blue\nGrape",         "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "w": {"type": "bush",      "label": "Green\nGrape",        "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "x": {"type": "bush",      "label": "Green\nGrape",        "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "A": {"type": "portal",    "label": "Town\nPortal",        "label_visible": 1,    "skill": 0,     "tile": "portal",     "grid": "",       "count": "1",       "planted": 1 },
    "B": {"type": "resource",  "label": "Tar",                 "label_visible": 1,    "skill": 0,     "tile": "tar",        "grid": "1x1",    "count": "1",       "planted": 1 },
    "C": {"type": "resource",  "label": "Moss",                "label_visible": 1,    "skill": 0,     "tile": "moss",       "grid": "1x1",    "count": "1",       "planted": 1 },
    "D": {"type": "bush",      "label": "Rose",                "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "E": {"type": "bush",      "label": "Raspberries",         "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "F": {"type": "bush",      "label": "Oleander",            "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "G": {"type": "bush",      "label": "Lingonberries",       "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "H": {"type": "bush",      "label": "Lavender\nflower",    "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "I": {"type": "bush",      "label": "Hazelnuts",           "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "J": {"type": "bush",      "label": "Camellia",            "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 },
    "K": {"type": "bush",      "label": "Blueberries",         "label_visible": 1,    "skill": 0,     "tile": "slab",       "grid": "9x9",    "count": "81",      "planted": 0 }
};

function generateGrid(grid, tileTypes) {
    const gridElement = document.getElementById('grid');

    const stylesheet_2 = document.createElement(`style`);
          stylesheet_2.innerHTML = `
            .tile {
                background-size: ${tile_size}px;
                width: ${tile_size}px;
                height: ${tile_size}px;
            }
            .grass   { background-color: #545932; background-image: url("../tile/grass/WurmUnlimited_tile_grass_${texture_size}x${texture_size}.png"); }
            .pottery,
            .portal  { background-color: #5B331D; background-image: url("../tile/pottery/WurmUnlimited_tile_pottery_${texture_size}x${texture_size}.png"); }
            .slab    { background-color: #747371; background-image: url("../tile/slab/WurmUnlimited_tile_slab_${texture_size}x${texture_size}.png"); }
            .farm    { background-color: #503F39; background-image: url("../tile/farm/WurmUnlimited_tile_farm_${texture_size}x${texture_size}.png"); }
            .tar     { background-color: #37353A; background-image: url("../tile/tar/WurmUnlimited_tile_tar_${texture_size}x${texture_size}.png"); }
            .moss    { background-color: #55560A; background-image: url("../tile/moss/WurmUnlimited_tile_moss_${texture_size}x${texture_size}.png"); }

            .portal .label  { font-size: 18px; left: ${-1 * tile_size}px; position: absolute; line-height: 20px; width: ${tile_size * 3}px !important;}
            .slab .label    { font-size: 18px; }
            .farm .label    { font-size: 18px; }
            .tar .label     { font-size: 15px; left: ${-1 * tile_size}px; position: absolute; width: ${tile_size * 3}px !important; line-height: 18px;}
            .moss .label    { font-size: 15px; left: ${-1 * tile_size}px; position: absolute; width: ${tile_size * 3}px !important; line-height: 18px;}
            .label {
                z-index: 11;
                text-align: center;
                text-shadow: 0px 0px 3px #000000,
                             0px 0px 3px #000000,
                             0px 0px 3px #000000,
                             0px 0px 3px #000000;
                position: absolute;
                width: 100%;
                /*border: 1px solid rebeccapurple;*/
            }
    `;

    gridElement.prepend(stylesheet_2);


    const rows = grid.trim().split('\n');

    const gridArray = rows.map(row => row.split(''));

    const row_length = gridArray[0].length;
    const col_length = gridArray.length;

    gridElement.style.gridTemplateColumns = `repeat(${row_length}, ${tile_size}px)`;
    gridElement.style.width = `${row_length * tile_size}px`;
    gridElement.style.height = `${col_length * tile_size}px`;

    const visited = Array.from({ length: col_length }, () => Array(row_length).fill(false));

    function isCrop(tile) {
        return tile === `2` ||
               tile === `3` ||
               tile === `4` ||
               tile === `5` ||
               tile === `6` ||
               tile === `7` ||
               tile === `8` ||
               tile === `9` ||
               tile === `a` ||
               tile === `b` ||
               tile === `c` ||
               tile === `d` ||
               tile === `e` ||
               tile === `f` ||
               tile === `g` ||
               tile === `h` ||
               tile === `i` ||
               tile === `j` ||
               tile === `k` ||
               tile === `l` ||
               tile === `m` ||
               tile === `n` ||
               tile === `o` ||
               tile === `p` ||
               tile === `q` ||
               tile === `r` ||
               tile === `s` ||
               tile === `t` ||
               tile === `u` ||
               tile === `v` ||
               tile === `w` ||
               tile === `x` ||
               tile === `D` ||
               tile === `E` ||
               tile === `F` ||
               tile === `G` ||
               tile === `H` ||
               tile === `I` ||
               tile === `J` ||
               tile === `K`;
    }

    function createTile(x, y, width, height, tileInfo) {
        const tileElement = document.createElement('div');
        tileElement.className = `tile ${tileInfo.tile}`;
        tileElement.style.width = `${width * tile_size}px`;
        tileElement.style.height = `${height * tile_size}px`;
        tileElement.style.top = `${y * tile_size}px`;
        tileElement.style.left = `${x * tile_size}px`;
        tileElement.style.position = 'absolute';

        if (tileInfo.label_visible) {
            const labelElement = document.createElement('div');
            labelElement.className = 'label';
            const grid = tileInfo.grid ? `${tileInfo.grid}<br>` : ``;
            const skill = tileInfo.skill ? `<br><br>farm skill<br>${tileInfo.skill}` : ``;
            labelElement.innerHTML = `${grid}${tileInfo.label}${skill}`;
            tileElement.appendChild(labelElement);
        }

        gridElement.appendChild(tileElement);
    }

    function findTileBounds(gridArray, startX, startY, tileType) {
        let maxX = startX;
        let maxY = startY;

        for (let y = startY; y < col_length; y++) {
            if (gridArray[y][startX] !== tileType) break;
            maxY = y;
        }

        for (let x = startX; x < row_length; x++) {
            if (gridArray[startY][x] !== tileType) break;
            maxX = x;
        }

        return { maxX, maxY };
    }

    for (let row = 0; row < col_length; row++) {
        for (let col = 0; col < row_length; col++) {
            if (!visited[row][col]) {
                const tileType = gridArray[row][col];
                const tileInfo = tileTypes[tileType];

                if (isCrop(tileType)) {
                    const { maxX, maxY } = findTileBounds(gridArray, col, row, tileType);
                    const width = maxX - col + 1;
                    const height = maxY - row + 1;

                    for (let y = row; y <= maxY; y++) {
                        for (let x = col; x <= maxX; x++) {
                            visited[y][x] = true;
                        }
                    }

                    createTile(col, row, width, height, tileInfo);
                } else {
                    createTile(col, row, 1, 1, tileInfo);
                    visited[row][col] = true;
                }
            }
        }
    }
}

generateGrid(grid, grid_tile_types);
</script>


</body>
</html>
